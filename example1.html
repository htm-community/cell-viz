<!DOCTYPE html>
<html>
    <head>
        <meta charset=utf-8>
        <title>Cell Regions</title>
        <style>
            body { margin: 0; }
            canvas { width: 100%; height: 100% }
        </style>
    </head>
    <body>

        <script src="https://code.jquery.com/jquery-3.1.0.slim.min.js"></script>
        <script src="dyson-bundle.js"></script>
        <script>

            $(function() {

                // The problem space.
                var numColumns = 2048;
                var cellsPerColumn = 4;
                var lengthLargestSide = 64;

                // Translate into cell dimensions.
                // x = left->right
                // y = down->up
                // z = near->far
                var x = numColumns / lengthLargestSide;
                var y = cellsPerColumn;
                var z = lengthLargestSide;

                var colors = {
                    0: 0xFFFFFF, // white for inactive cells
                    1: 0xFFFF00, // yellow for active cells
                    2: 0xFF0000, // red for predictive cells
                    3: 0xFFAC33, // orange for active & predictive cells
                    4: 0x6699FF, // cyan for correctly predicted cells from last step
                    5: 0x00FF00  // green for input bits
                };

                // The Cells interface is how to update the visualization inside the canvas.
                var cells = new HtmCells(x, y, z);

                // The HtmCellVisualization object handles all interactions with the DOM.
                var cellviz = new SingleLayerVisualization(
                    cells, {colors: colors}
                );

                // Renders the canvas with empty cells into the DOM and canvas.
                cellviz.render({
                    position: {
                        x: -40,
                        y: 40
                    },
                    rotation: {
                        x: -1.2
                    },
                    camera: {
                        z: 40
                    }
                });

                // Update cells with random colors every so often.
                setInterval(function() {
                    console.log('redrawing new cells...');
                    // Throw in a bunch of random colored cells.
                    colorCellsRandomly(cells);
                    // This call actually updates the mesh representation within
                    // the drawing. It must be called to show the updated cell
                    // representation.
                    cellviz.redraw();
                }, 2000);

                function colorCellsRandomly(myCells) {
                    for (var cx = 0; cx < x; cx++) {
                        for (var cy = 0; cy < y; cy++) {
                            for (var cz = 0; cz < z; cz++) {
                                myCells.update(
                                    cx, cy, cz,
                                    getRandomIntInclusive(0, 5)
                                );
                            }
                        }
                    }
                }

                function getRandomIntInclusive(min, max) {
                    min = Math.ceil(min);
                    max = Math.floor(max);
                    return Math.floor(Math.random() * (max - min + 1)) + min;
                }

            });

        </script>
    </body>
</html>
